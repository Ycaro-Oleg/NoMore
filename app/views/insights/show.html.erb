<div class="space-y-8">
  <div>
    <h1 class="text-3xl font-bold text-white">Your Patterns</h1>
    <p class="mt-1 text-gray-400">This is what your behavior actually looks like. No filters.</p>
  </div>

  <% if @analytics.total_count.zero? %>
    <div class="rounded-xl border border-gray-800 bg-gray-900 p-12 text-center">
      <p class="text-lg text-gray-400">No data yet.</p>
      <p class="mt-1 text-sm text-gray-500">Make some commitments first. Then we'll show you who you really are.</p>
    </div>
  <% else %>

    <!-- Core Numbers -->
    <div class="grid grid-cols-2 gap-4 sm:grid-cols-5">
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-4">
        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">Total</p>
        <p class="mt-1 text-2xl font-bold text-white"><%= @analytics.total_count %></p>
      </div>
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-4">
        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">Completed</p>
        <p class="mt-1 text-2xl font-bold text-green-400"><%= @analytics.completed_count %></p>
      </div>
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-4">
        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">Failed</p>
        <p class="mt-1 text-2xl font-bold text-red-400"><%= @analytics.failed_count %></p>
      </div>
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-4">
        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">Streak</p>
        <p class="mt-1 text-2xl font-bold text-amber-400"><%= @analytics.current_streak %></p>
      </div>
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-4">
        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">Best Streak</p>
        <p class="mt-1 text-2xl font-bold text-amber-400"><%= @analytics.longest_streak %></p>
      </div>
    </div>

    <!-- Completion vs Failure Rate -->
    <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
      <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Accountability Score</h2>
      <div class="flex items-end gap-1 h-8">
        <% if @analytics.completion_rate > 0 %>
          <div class="bg-green-500 rounded-l h-full transition-all" style="width: <%= @analytics.completion_rate %>%"></div>
        <% end %>
        <% if @analytics.fail_rate > 0 %>
          <div class="bg-red-500 rounded-r h-full transition-all" style="width: <%= @analytics.fail_rate %>%"></div>
        <% end %>
      </div>
      <div class="flex justify-between mt-2 text-xs">
        <span class="text-green-400">Kept: <%= @analytics.completion_rate %>%</span>
        <span class="text-red-400">Broke: <%= @analytics.fail_rate %>%</span>
      </div>
      <% if @analytics.fail_rate > 50 %>
        <p class="mt-3 text-sm text-red-400">You break more commitments than you keep. That's not bad luck — that's a pattern.</p>
      <% elsif @analytics.fail_rate > 30 %>
        <p class="mt-3 text-sm text-amber-400">Almost a third of your commitments fail. You know why.</p>
      <% elsif @analytics.completion_rate > 80 %>
        <p class="mt-3 text-sm text-green-400">High accountability. Keep it real.</p>
      <% end %>
    </div>

    <!-- Procrastination Patterns -->
    <div class="grid gap-4 sm:grid-cols-2">
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Last-Minute Completions</h2>
        <p class="text-3xl font-bold text-amber-400"><%= @analytics.last_minute_completions %>%</p>
        <p class="mt-1 text-xs text-gray-500">Completed less than 1 hour before deadline</p>
        <% if @analytics.last_minute_completions > 50 %>
          <p class="mt-3 text-sm text-amber-400">You're not disciplined — you're just scared of failing. There's a difference.</p>
        <% end %>
      </div>

      <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Avg. Completion Speed</h2>
        <% if @analytics.avg_completion_speed %>
          <p class="text-3xl font-bold text-white"><%= @analytics.avg_completion_speed %>h</p>
          <p class="mt-1 text-xs text-gray-500">Average hours from commitment to completion</p>
        <% else %>
          <p class="text-lg text-gray-500">No completions yet</p>
        <% end %>
      </div>
    </div>

    <!-- Time Patterns -->
    <div class="grid gap-4 sm:grid-cols-2">
      <% if @analytics.peak_failure_day %>
        <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
          <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Worst Day</h2>
          <p class="text-3xl font-bold text-red-400"><%= @analytics.peak_failure_day %></p>
          <p class="mt-1 text-xs text-gray-500">The day you fail the most</p>

          <!-- Day breakdown -->
          <div class="mt-4 space-y-2">
            <% max_day = @analytics.failure_by_day_of_week.values.max || 1 %>
            <% @analytics.failure_by_day_of_week.each do |day, count| %>
              <div class="flex items-center gap-3">
                <span class="text-xs text-gray-400 w-8"><%= day %></span>
                <div class="flex-1 h-2 rounded-full bg-gray-800">
                  <div class="h-2 rounded-full bg-red-500/70" style="width: <%= (count.to_f / max_day * 100).round %>%"></div>
                </div>
                <span class="text-xs text-gray-500 w-4"><%= count %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if @analytics.peak_failure_hour %>
        <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
          <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Worst Hour</h2>
          <p class="text-3xl font-bold text-red-400"><%= @analytics.peak_failure_hour %></p>
          <p class="mt-1 text-xs text-gray-500">The time of day you fail the most</p>

          <!-- Hour breakdown -->
          <div class="mt-4 space-y-1">
            <% max_hour = @analytics.failure_by_hour.values.max || 1 %>
            <% @analytics.failure_by_hour.sort.each do |hour, count| %>
              <div class="flex items-center gap-3">
                <span class="text-xs text-gray-400 w-12"><%= hour.to_i < 12 ? "#{hour == 0 ? 12 : hour} AM" : "#{hour == 12 ? 12 : hour - 12} PM" %></span>
                <div class="flex-1 h-1.5 rounded-full bg-gray-800">
                  <div class="h-1.5 rounded-full bg-red-500/70" style="width: <%= (count.to_f / max_hour * 100).round %>%"></div>
                </div>
                <span class="text-xs text-gray-500 w-4"><%= count %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Category Breakdown -->
    <% categories = @analytics.category_breakdown %>
    <% if categories.any? %>
      <div class="rounded-xl border border-gray-800 bg-gray-900 p-6">
        <h2 class="text-sm font-semibold uppercase tracking-wider text-gray-400 mb-4">Category Reality Check</h2>
        <div class="space-y-4">
          <% categories.each do |cat| %>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm font-medium text-gray-300 capitalize"><%= cat[:category] %></span>
                <span class="text-xs text-gray-500">
                  <span class="text-green-400"><%= cat[:completed] %></span> /
                  <span class="text-red-400"><%= cat[:failed] %></span> /
                  <%= cat[:total] %>
                </span>
              </div>
              <div class="h-2 w-full rounded-full bg-gray-800">
                <div class="h-2 rounded-full <%= cat[:rate] >= 70 ? 'bg-green-500' : cat[:rate] >= 40 ? 'bg-amber-500' : 'bg-red-500' %>" style="width: <%= cat[:rate] %>%"></div>
              </div>
              <% if cat[:rate] < 30 && cat[:total] >= 2 %>
                <p class="mt-1 text-xs text-red-400">You keep committing to <strong><%= cat[:category] %></strong> and keep failing. Either do it or stop lying to yourself.</p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

  <% end %>
</div>
